@page "/tests"
@using CheesyCroco.Data.Models
@using CheesyCroco.Data.Services
@inject TestService testService

<PageTitle>Tests</PageTitle>

<h1>Cheesy Croco Tests</h1>


@* <p>There is the test list.</p> *@

@if (tests == null)
{
    <p><em>Loading...</em></p>
}
else
{
    @*   <meta> @tests.Length <meta>
    <table class="table">
        <thead>
            <tr>
                <th>Name</th>
                <th>Test pass number</th>
                <th>Test rate</th>
                <th>Number of questions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var test in tests)
            {
                <tr>
                    <td>
                        <NavLink class="btn btn-square" href="testpage">@test.name</NavLink>
                    </td>
                    <td>@test.passCounter</td>
                    <td>@GetTestRate(test.rateSum, test.rateNum)</td>
                    <td>@test.questionsNum</td>
                </tr>
            }
        </tbody>
    </table> *@
    @for (int i =0; i < tests.Length / 3; i++)
    {
        <div class="tests_row">
            @for (int j = 0; j < 3; j++)
            {
                <div class="test_item" onclick="location.href='testpage';">
                    <div class="test_item-title">
                        <h3>
                            @tests[i + j].name
                        </h3>
                    </div>

                    <div class="test_item-bottom">
                        <div class="test_item-questionsNum" title="Оценка по 10-бальной шкале">@tests[i + j].questionsNum</div>
                        <div class="test_item-rating" title="Количество прохождений">@GetTestRate(tests[i + j].rateSum, tests[i + j].rateNum)</div>
                        <div class="test_item-passes" title="">@tests[i + j].passCounter</div>
                    </div>
                    
                    
                </div>
            }
        </div>
    }
   
}


@code {
    private Test[] tests;

    protected double GetTestRate(int a, int b)
    {
        return 1.0 * a / b;
    }

    protected override async Task OnInitializedAsync()
    {
        if (testService.connect()){
            tests = await testService.GetTestAsync();
        }
        else{
            tests = await Task.FromResult(Enumerable.Range(1, 5).Select(index => new Test
                {
                    name = "Test name (click on me)",
                    rateNum = 0,
                    rateSum = 1,
                    questionsNum = 1,
                    passCounter = 0
                }).ToArray());
        }
    }
}
